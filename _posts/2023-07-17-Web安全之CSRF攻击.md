---
title: "CSRF攻击"
tags: TeXt
---

# CSRF攻击——陌生的链接不要随便点

CSRF是诱导用户点击黑客的网站，利用用户的登录状态，并通过第三方的站点来做一些坏事。当我们打开黑客的网站之后，黑客就有三种方式来进行CSRF的攻击。如下图：

![]({{site.url}}/assets/blogImages/blog018/18-1.png)

### 如何实施CSRF攻击？

本次讲解的接口如下：对用户的账户进行转账处理

![]({{site.url}}/assets/blogImages/blog018/18-2.png)

##### 1、自动发送get请求

点击黑客的链接，在加载黑客的网站的时候，自动发起get的请求。如下图：

![]({{site.url}}/assets/blogImages/blog018/18-3.png)

当我们加载HTML的代码的时候，我们会加载图片的资源，就是自动发送一个get请求。如果服务器没有对这个请求进行验证，就会造成CSRF攻击。

##### 2、自动发送post请求

有些服务器的接口是使用POST方法的，所以黑客还需要在他的站点上伪造POST请求，当用户打开黑客的站点时，是自动提交POST请求，具体的方式你可以参考下面示例代码：

![]({{site.url}}/assets/blogImages/blog018/18-4.png)

当我们自动加载页面的时候，也会自动提交表单给服务器进行转账的操作。

##### 3、引诱用户点击链接

![]({{site.url}}/assets/blogImages/blog018/18-5.png)

当我们点击图中的链接进行下载的时候，也会进行转账的功能。

通过上述的描述，我们发现CSRF攻击与XSS攻击不同的是：CSRF不会将恶意的代码注入到用户的页面，而是利用服务器的漏洞和用户的登录状态进行攻击的。

进行CSRF要满足的条件：

1、服务器存在CSRF的漏洞

2、浏览器拿到了用户的登录状态。

3、通过第三方网站进行请求的发送。

### 如何预防CSRF的攻击？

##### 1、充分利用好cookie的sameSite属性

由于CSRF的攻击是利用浏览器和服务器之间cookie的属性。所以，当第三方网站进行请求时，我们要禁止携带cookie。就需要在服务器端返回cookie的时候，将浏览器的cookie加上sameSite=strict。

##### 2、服务器验证请求的来源站点

通过验证HTTP的Referer和Origin属性来判断请求的网站是不是第三方网站。

##### 3、CSRF Token

第一步，页面向浏览器发送请求的时候，自动设置它的token值（其实就是一个字符串），前端将token值植入到页面中。在后续的请求携带上token值。如下图：

![]({{site.url}}/assets/blogImages/blog018/18-6.png)

第二步，服务器判断有无token值。如果是第三方站点发送请求，则不会携带token值进行请求。