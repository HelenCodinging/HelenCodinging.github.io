---
title: "Web安全-跨站脚本攻击"
tags: TeXt
---

# 跨站脚本攻击(XSS)

浏览器无法判断执行的JavaScript的代码是否为是恶意的代码，并且JavaScript的代码是可以访问到用户页面输入的密码、浏览器的cookie等敏感信息。如果黑客往浏览器注入恶意的JavaScript的代码来获取用户的隐私信息，就会造成信息泄露等安全问题。

### 恶意的脚本能做哪些事？

1、窃取cookie信息

恶意的脚本可以通过document.cookie来窃取cookie的信息

2、监听用户的行为

恶意JavaScript可以使用“addEventListener”接⼝来监听键盘事件，比如可以获取用户输⼊的信用卡等信息，将其发送到恶意服务器。黑客掌握了这些信息之后，又可以做很多违法的事情。

3、利用DOM来伪造登录接口

4、在页面内生成浮窗广告，影响用户的体验。

### XSS的本质

XSS的本质就是⿊客往⻚⾯中注⼊恶意脚本，然后将⻚⾯的⼀些重要数据上传到恶意服务器。

### XSS的攻击

常见的三种XSS 攻击模式是存储型XSS攻击、反射型XSS攻击和基于DOM的XSS攻击。

#### （一）存储型XSS

黑客通过提交恶意的代码给服务器，服务器在数据库中保存恶意的代码，当用户请求含有恶意的代码的页面时，服务器将含有恶意代码的网页转发给浏览器，浏览器执行恶意的代码，恶意的代码获取到信息交给黑客服务器。

如下图：

![]({{site.url}}/assets/blogImages/blog017/17-1.png)

#### (二)反射型XSS

在⼀个反射型XSS攻击过程中，恶意JavaScript脚本属于用户发送给网站请求中的⼀部分，随后网站又把恶 意JavaScript脚本返回给用户。当恶意JavaScript脚本在用户页面中被执行时，黑客就可以利用该脚本做⼀ 些恶意操作。表现形式是让用户点击一个恶意网站的链接。

它与存储型XSS的区别是:存储型XSS是会将恶意的代码保存到数据库，而反射型XSS不会将恶意的代码存储到数据库。如下图：

![]({{site.url}}/assets/blogImages/blog017/17-2.png)

#### (三）DOM型XSS

DOM型的XSS是不会经过Web服务器的，而是直接对浏览器进行攻击。具体来讲，黑客通过各种手段将恶意脚本注⼊用户的页面中，比如通过网络劫持在页面传输过程中修改HTML页面的内容。

### 如何预防XSS攻击？

由于反射型XSS与存储型XSS都需要通过服务器端，我们可以在服务器端进行处理，可以利用过滤的手段，将恶意的JavaScript代码进行过滤。

如下图：

过滤前的代码：

![]({{site.url}}/assets/blogImages/blog017/17-3.png)

过滤后的代码：

![]({{site.url}}/assets/blogImages/blog017/17-4.png)

或者对JS的代码进行转义，使得它无法执行。如下图：

![]({{site.url}}/assets/blogImages/blog017/17-5.png)

XSS的攻击一般都是获取浏览器的cookie信息，所以，我们可以使用在HTTP的响应中对cookie的信息加httpOnly，这意味着JS不能通过document.cookie来获得。

还有另一种方法是充分利用好CSP:禁止下载第三方的资源、禁止向第三方库提交数据等。